these changes are made by b2 branch. 
I think i have done a good job
