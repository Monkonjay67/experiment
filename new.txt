These changes are made by b2 branch.
 I think I have done a good job.
